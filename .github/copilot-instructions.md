# Copilot Instructions — TherapyLens (neurohacks)

Summary

- Frontend-only React single-page app. No backend in this repo: realtime metrics are simulated in `src/App.jsx` and AI calls are made directly from the browser to Anthropic/Claude.

How to start (local dev)

- Install: `npm install`
- Dev server: `npm run dev` (Vite, opens on port 3000 by default)
- Build: `npm run build` → `dist/`
- Preview build: `npm run preview`
- Lint: `npm run lint` (runs `eslint src`)

Important runtime notes

- Webcam access requires HTTPS or `localhost`. Vite config (`vite.config.js`) comments recommend enabling HTTPS in dev for real webcam testing.
- No server-side storage: metrics, alerts, and reports are stored in browser memory and exported as anonymous JSON via `exportReport` in `src/App.jsx`.
- Claude/Anthropic calls are invoked in `src/App.jsx` in `generateClaudeInsight` and `generateSessionReport` via `fetch('https://api.anthropic.com/v1/messages', ...)`. The code currently omits an API key header — add an `x-api-key` header and use a Vite env var (see Examples below).

Key files and why they matter

- `src/App.jsx` — main application: session lifecycle, simulated metrics, alert logic, Claude integration, UI. Primary place to change thresholds, insight frequency, and data export.
- `src/main.jsx` — React entry; mounts `App` component.
- `index.html` — app entry used by Vite.
- `package.json` — scripts and dependencies (React, Recharts, Lucide icons, Vite, Tailwind).
- `vite.config.js` — dev server settings (port, https comment), build chunking.
- `tailwind.config.js` — custom color tokens under `theme.extend.colors.therapy` (use these tokens in classes).
- `README.md` — product-level overview and useful implementation notes (WebGazer/MediaPipe references; many features are currently simulated).

Project-specific patterns and conventions

- Local-first, privacy-first: features assume local-only processing; avoid adding server-side persistence without clarifying privacy implications.
- Metrics schema: `metricsHistory` array objects contain `{ time, eyeContact, breathing, gaze }` — many helpers (charts, timeline) expect these keys.
- Alerts: generated by `checkForAlerts(ec, br, gs)` in `src/App.jsx`. Thresholds are hard-coded (examples: `br > 25`, `ec < 20`). Edit these lines to change behavior.
- Claude insights schedule: triggered when `sessionDuration % 120 === 0` (every 2 minutes). Change in `useEffect` watching `sessionDuration`.

Concrete examples / copy-paste fixes

- Add Anthropic API key using Vite env var (create `.env` with `VITE_ANTHROPIC_KEY=...`) and update fetch headers:

  - header: `'x-api-key': import.meta.env.VITE_ANTHROPIC_KEY`
  - Keep keys out of VCS (add `.env` to `.gitignore`).

- Fix a runtime bug in `src/App.jsx` (likely to block dev server): the file defines `const App = () => { ... }` but exports `TherapyLens`. Change the export to `export default App;`.

Debugging tips

- If webcam is blank or not allowed: ensure `https` or `localhost`; check browser permissions and console errors from `navigator.mediaDevices.getUserMedia`.
- If Claude calls fail: check network tab, add API key, or mock response locally for offline dev.
- If the app does not mount, check `src/main.jsx` imports and default export in `src/App.jsx` (see fix above).

Style & UI

- Uses Tailwind utility classes; colors are centralized in `tailwind.config.js` under `therapy` — reuse those tokens for consistent branding.
- Charts use `recharts` and expect `metricsHistory` as the data source.

Safety & privacy

- Never commit API keys. The app is explicitly designed to avoid storing video/audio; maintain this pattern when adding features.

If anything is unclear or you want me to include more examples (e.g., exact line numbers to patch, environment setup for HTTPS dev, or a ready `.env.example`), tell me which part to expand and I will update the file.
